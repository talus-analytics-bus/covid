{"ast":null,"code":"import countriesSource from '../../assets/featureCollections/countries.geojson';\nimport dialysisIcon from '../../assets/images/markers/dialysis-blue.png';\nimport hospitalIcon from '../../assets/images/markers/hospital-blue.png';\nimport nursingIcon from '../../assets/images/markers/nursing-blue.png';\nimport dialysisStableIcon from '../../assets/images/markers/dialysis-green.png';\nimport hospitalStableIcon from '../../assets/images/markers/hospital-green.png';\nimport nursingStableIcon from '../../assets/images/markers/nursing-green.png';\nimport dialysisAlertedIcon from '../../assets/images/markers/dialysis-yellow.png';\nimport hospitalAlertedIcon from '../../assets/images/markers/hospital-yellow.png';\nimport nursingAlertedIcon from '../../assets/images/markers/nursing-yellow.png';\nimport dialysisCriticalIcon from '../../assets/images/markers/dialysis-red.png';\nimport hospitalCriticalIcon from '../../assets/images/markers/hospital-red.png';\nimport nursingCriticalIcon from '../../assets/images/markers/nursing-red.png';\nconst param = {\n  facility: {\n    minZoom: 8\n  },\n  cluster: {\n    maxZoom: 8,\n    threshZoom: 7 // threshZoom: 14,\n\n  }\n};\n\nconst initMap = (map, observations) => {\n  map.on('load', function () {\n    addImages();\n    initGeoms();\n  });\n\n  const addImages = () => {\n    Array(['dialysis-stable', dialysisStableIcon], ['hospital-stable', hospitalStableIcon], ['nursing-stable', nursingStableIcon], ['dialysis-alerted', dialysisAlertedIcon], ['hospital-alerted', hospitalAlertedIcon], ['nursing-alerted', nursingAlertedIcon], ['dialysis-critical', dialysisCriticalIcon], ['hospital-critical', hospitalCriticalIcon], ['nursing-critical', nursingCriticalIcon]).forEach(([name, icon]) => {\n      map.loadImage(icon, (err, img) => {\n        map.addImage(name, img);\n      });\n    });\n  };\n\n  const initGeoms = () => {\n    if (!map.getSource('geoms')) map.addSource('geoms', {\n      type: 'geojson',\n      data: countriesSource\n    });\n    observations.forEach(observation => {\n      const value = observation['value'];\n      const iso = observation['iso'];\n\n      if (!value) {\n        map.setFeatureState({\n          iso,\n          source: 'geoms'\n        }, {});\n      } else {\n        const state = {\n          value: value\n        };\n        map.setFeatureState({\n          iso,\n          source: 'geoms'\n        }, state);\n      }\n    });\n    map.addLayer({\n      id: 'geom-fills',\n      type: 'fill',\n      source: 'geoms',\n      paint: {\n        'fill-color': ['step', ['feature-state', 'count'], '#429EFF', 100, '#80FF9E', 250, '#F0FF3D', 500, '#FF94A6', 750, '#C399FF'],\n        'fill-opacity': 0.5\n      }\n    });\n    map.addLayer({\n      id: 'selected-fill',\n      type: 'fill',\n      source: 'geoms',\n      filter: ['!', true],\n      paint: {\n        'fill-color': '#627BC1',\n        'fill-opacity': 0.5\n      }\n    });\n    map.addLayer({\n      id: 'selected-border',\n      type: 'line',\n      source: 'geoms',\n      filter: ['!', true],\n      paint: {\n        'line-color': '#627BC1',\n        'line-width': 2\n      }\n    });\n  };\n};\n\nexport default initMap;","map":{"version":3,"sources":["/Users/trae/git_repositories/measles/dash/src/components/map/mapUtils.js"],"names":["countriesSource","dialysisIcon","hospitalIcon","nursingIcon","dialysisStableIcon","hospitalStableIcon","nursingStableIcon","dialysisAlertedIcon","hospitalAlertedIcon","nursingAlertedIcon","dialysisCriticalIcon","hospitalCriticalIcon","nursingCriticalIcon","param","facility","minZoom","cluster","maxZoom","threshZoom","initMap","map","observations","on","addImages","initGeoms","Array","forEach","name","icon","loadImage","err","img","addImage","getSource","addSource","type","data","observation","value","iso","setFeatureState","source","state","addLayer","id","paint","filter"],"mappings":"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","sourcesContent":["import countriesSource from '../../assets/featureCollections/countries.geojson'\n\nimport dialysisIcon from '../../assets/images/markers/dialysis-blue.png'\nimport hospitalIcon from '../../assets/images/markers/hospital-blue.png'\nimport nursingIcon from '../../assets/images/markers/nursing-blue.png'\nimport dialysisStableIcon from '../../assets/images/markers/dialysis-green.png'\nimport hospitalStableIcon from '../../assets/images/markers/hospital-green.png'\nimport nursingStableIcon from '../../assets/images/markers/nursing-green.png'\nimport dialysisAlertedIcon from '../../assets/images/markers/dialysis-yellow.png'\nimport hospitalAlertedIcon from '../../assets/images/markers/hospital-yellow.png'\nimport nursingAlertedIcon from '../../assets/images/markers/nursing-yellow.png'\nimport dialysisCriticalIcon from '../../assets/images/markers/dialysis-red.png'\nimport hospitalCriticalIcon from '../../assets/images/markers/hospital-red.png'\nimport nursingCriticalIcon from '../../assets/images/markers/nursing-red.png'\n\nconst param = {\n  facility: {\n    minZoom: 8,\n  },\n  cluster: {\n    maxZoom: 8,\n    threshZoom: 7,\n    // threshZoom: 14,\n  }\n};\n\nconst initMap = (map, observations) => {\n\n  map.on('load', function() {\n    addImages()\n    initGeoms()\n  })\n\n  const addImages = () => {\n    Array(\n      ['dialysis-stable', dialysisStableIcon],\n      ['hospital-stable', hospitalStableIcon],\n      ['nursing-stable', nursingStableIcon],\n      ['dialysis-alerted', dialysisAlertedIcon],\n      ['hospital-alerted', hospitalAlertedIcon],\n      ['nursing-alerted', nursingAlertedIcon],\n      ['dialysis-critical', dialysisCriticalIcon],\n      ['hospital-critical', hospitalCriticalIcon],\n      ['nursing-critical', nursingCriticalIcon]\n    ).forEach(([name, icon]) => {\n      map.loadImage(icon, (err, img) => {\n        map.addImage(name, img)\n      })\n    })\n  }\n\n  const initGeoms = () => {\n    if (!map.getSource('geoms'))\n      map.addSource('geoms', {\n        type: 'geojson',\n        data: countriesSource\n      })\n\n    observations.forEach(( observation) => {\n      const value = observation['value'];\n      const iso = observation['iso']\n      if (!value) {\n        map.setFeatureState({ iso, source: 'geoms' }, {});\n      } else {\n        const state = { value: value};\n        map.setFeatureState({ iso, source: 'geoms' }, state);\n      }\n    });\n\n    map.addLayer({\n      id: 'geom-fills',\n      type: 'fill',\n      source: 'geoms',\n      paint: {\n        'fill-color': [\n          'step',\n          ['feature-state', 'count'],\n           '#429EFF', 100,\n           '#80FF9E', 250,\n           '#F0FF3D', 500,\n           '#FF94A6', 750,\n           '#C399FF'\n        ],\n        'fill-opacity': 0.5\n      }\n    })\n\n    map.addLayer({\n      id: 'selected-fill',\n      type: 'fill',\n      source: 'geoms',\n      filter: ['!', true],\n      paint: {\n        'fill-color': '#627BC1',\n        'fill-opacity': 0.5\n      }\n    })\n\n    map.addLayer({\n      id: 'selected-border',\n      type: 'line',\n      source: 'geoms',\n      filter: ['!', true],\n      paint: {\n        'line-color': '#627BC1',\n        'line-width': 2\n      }\n    })\n  }\n}\n\nexport default initMap\n"]},"metadata":{},"sourceType":"module"}